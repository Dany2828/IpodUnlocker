name: Build iPodUnlocker

on:
  workflow_dispatch:        # run manually from the Actions tab
  push:
  pull_request:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Enable .NET Framework 3.5
        run: dism /online /enable-feature /featurename:NetFX3 /all

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2

      # Just to see what's in the repo
      - name: List solution and project files
        shell: pwsh
        run: |
          Write-Host "=== .sln files ==="
          Get-ChildItem -Recurse -Include *.sln | Select-Object FullName
          Write-Host "`n=== project files ==="
          Get-ChildItem -Recurse -Include *.csproj,*.vbproj,*.vcproj | Select-Object FullName

      # Build the first project it finds (no need to name iPodUnlocker.sln here)
      - name: Build project (auto-detect)
        shell: pwsh
        run: |
          $proj = Get-ChildItem -Recurse -Include *.csproj,*.vbproj,*.vcproj | Select-Object -First 1
          if (-not $proj) {
            throw "No project file (*.csproj, *.vbproj, *.vcproj) found in the repository."
          }
          Write-Host "Building project: $($proj.FullName)"
          msbuild $proj.FullName /p:Configuration=Release /v:detailed

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: iPodUnlocker-build
          path: |
            **/bin/**
